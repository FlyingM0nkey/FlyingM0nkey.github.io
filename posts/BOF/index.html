<!DOCTYPE html><html lang="en" mode="dark" > <!-- The Head v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Buffer Overflow Demo | Flying_M0nkey</title><meta name="generator" content="Jekyll v4.1.1" /><meta property="og:title" content="Buffer Overflow Demo" /><meta name="author" content="Flying_M0nkey" /><meta property="og:locale" content="en_US" /><meta name="description" content="A quick and easy method to complete an OSCP style Buffer OverFlow exercise. This is a demo of how to use my scripts, not a lesson on Buffer OverFlows - that’s way over this skript kiddie’s head. There’s a link to a video walkthrough at the bottom that should clarify any issues that aren’t crystal clear already." /><meta property="og:description" content="A quick and easy method to complete an OSCP style Buffer OverFlow exercise. This is a demo of how to use my scripts, not a lesson on Buffer OverFlows - that’s way over this skript kiddie’s head. There’s a link to a video walkthrough at the bottom that should clarify any issues that aren’t crystal clear already." /><link rel="canonical" href="protocol://flyingm0nkey.github.io/posts/BOF/" /><meta property="og:url" content="protocol://flyingm0nkey.github.io/posts/BOF/" /><meta property="og:site_name" content="Flying_M0nkey" /><meta property="og:image" content="protocol://flyingm0nkey.github.io/assets/img/bof/buff.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-10-12T18:08:00+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="protocol://flyingm0nkey.github.io/assets/img/bof/buff.png" /><meta property="twitter:title" content="Buffer Overflow Demo" /><meta name="twitter:site" content="@twitter_is_the_devil" /><meta name="twitter:creator" content="@Flying_M0nkey" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"A quick and easy method to complete an OSCP style Buffer OverFlow exercise. This is a demo of how to use my scripts, not a lesson on Buffer OverFlows - that’s way over this skript kiddie’s head. There’s a link to a video walkthrough at the bottom that should clarify any issues that aren’t crystal clear already.","headline":"Buffer Overflow Demo","dateModified":"2020-10-12T18:08:00+08:00","datePublished":"2020-10-12T18:08:00+08:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"protocol://flyingm0nkey.github.io/posts/BOF/"},"image":"protocol://flyingm0nkey.github.io/assets/img/bof/buff.png","url":"protocol://flyingm0nkey.github.io/posts/BOF/","author":{"@type":"Person","name":"Flying_M0nkey"},"@context":"https://schema.org"}</script> <!-- The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps Generated by: https://www.favicon-generator.org/ v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT license --><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"> <!-- CSS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /><link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"> <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" async></script> <!-- JS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --> <script src="/assets/js/post.min.js" async></script> <script src="/app.js" defer></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"> <!-- The Side Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">Flying_M0nkey</a></div><div class="site-subtitle font-italic">A desperate attempt to store my notes where I can find them.</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></li></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <a href="https://github.com/FlyingM0nkey" target="_blank"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/twitter_is_the_devil" target="_blank"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:window.open('mailto:' + ['nobody_uses','email.com'].join('@'))" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" > <i class="fas fa-rss"></i> </a></div></div><!-- The Top Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Buffer Overflow Demo</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"> <!-- Refactor the HTML structure. --> <!-- Suroundding the markdown table with '<div class="table-wrapper">. and '</div>' --> <!-- Fixed kramdown code highlight rendering: https://github.com/penibelst/jekyll-compress-html/issues/101 https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901 --><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Buffer Overflow Demo</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Oct 12, 2020, 6:08 PM +0800" > Oct 12 <i class="unloaded">2020-10-12T18:08:00+08:00</i> </span> by <span class="author"> Flying_M0nkey </span></div><div> Updated <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Wed, Oct 14, 2020, 1:06 PM -0400" > Oct 14 <i class="unloaded">2020-10-15T01:06:48+08:00</i> </span></div></div><div class="post-content"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/bof/buff.png" class="post-preview-img"><p>A quick and easy method to complete an OSCP style Buffer OverFlow exercise. This is a demo of how to use my scripts, not a lesson on Buffer OverFlows - that’s way over this skript kiddie’s head. There’s a link to a video walkthrough at the bottom that should clarify any issues that aren’t crystal clear already.</p><p><strong><em>note - if you are using my scripts against an application without a vulnerable command, like <a href="https://github.com/justinsteven/dostackbufferoverflowgood">DoStackOverflowGood</a>, you will need to comment out one line and uncomment the line below it.</em></strong></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/bof/pic31.png" alt="comment" /></p><h2 id="setup">Setup</h2><p>For this exercise I will be using Vulnserver. Please read the <a href="https://github.com/stephenbradshaw/vulnserver">README</a> and then download the <a href="https://github.com/stephenbradshaw/vulnserver/blob/master/vulnserver.exe">executable</a>.</p><p>Download and install <a href="https://www.immunityinc.com/products/debugger/">Immunity Debugger</a>. You will need to download and install <a href="https://github.com/corelan/mona">mona.py</a> into Immunity. The install directions are on the README page.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/bof/pic1.png" alt="DBG" /></p><p>The Vulnserver executable and Immunity Debugger need to be installed in the same environment.</p><p>If you have a Windows VM you can install this on, great! I do not, so I will install on my host desktop for easy access. Because of this, I will stop the demo at the point where I would execute the reverse shell because I don’t really want to mess with the firewall settings on my machine.</p><p>To make this go quickly, I highly recommend using <a href="https://code.visualstudio.com/">Visual Studo Code</a>, or a similar program, on your attacking machine that will allow you to import a folder and execute scripts. Having all the scripts in one place, ready to edit and execute is what makes this method so quick.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/bof/pic2.png" alt="VSC" /></p><p>Finally, the scripts can be <a href="https://github.com/FlyingM0nkey/BOF">downloaded</a> here. I suggest keeping a master copy of the scripts and copying to a working folder any time you want to practice your BOF.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/bof/pic3.png" alt="Folder" /></p><h2 id="find-the-eip">Find The EIP</h2><p>I’ve made a copy of my master folder and imported it into VSC. I am starting with script number 2 because script 1 is a simple fuzzing script, which we do not need. We can assume that we will be given an example exploit POC telling us the vulnerable function, if there is one, the port the service is running on, and the buffer length. This is all the information we need to complete a “vanilla” BOF.</p><p>Here is what the POC for Vulnserver looks like.</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="c">#!/usr/bin/python</span>

import sys, socket

<span class="k">if </span>len<span class="o">(</span>sys.argv<span class="o">)</span> &lt; 2:
    print <span class="s2">"</span><span class="se">\n</span><span class="s2">Usage: "</span> + sys.argv[0] + <span class="s2">" &lt;target_ip&gt;</span><span class="se">\n</span><span class="s2">"</span>
    sys.exit<span class="o">()</span>

cmd <span class="o">=</span> <span class="s2">"TRUN /.:/"</span>       <span class="c"># Vulnerable function</span>
junk <span class="o">=</span> <span class="s2">"</span><span class="se">\x</span><span class="s2">41"</span> <span class="k">*</span> 3000    <span class="c"># Fill buffer with A's</span>
end <span class="o">=</span> <span class="s2">"</span><span class="se">\r\n</span><span class="s2">"</span>

buffer <span class="o">=</span> cmd + junk + end

s <span class="o">=</span> socket.socket<span class="o">(</span>socket.AF_INET, socket.SOCK_STREAM<span class="o">)</span>
s.connect<span class="o">((</span>sys.argv[1], 9999<span class="o">))</span>
s.send<span class="o">(</span>buffer<span class="o">)</span>
s.recv<span class="o">(</span>1024<span class="o">)</span>
s.close<span class="o">()</span>
</pre></table></code></div></div><p>From the above POC I can see that the vulnerable function is <code class="language-plaintext highlighter-rouge">TRUN /.:/</code>, the buffer length is 3,000 bytes and the port it is running on is 9999. If you look at the top of script 2 you can see variable inputs for these values.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/bof/pic4.png" alt="EIP" /></p><p>On every script there is a set of instructions below the variables and any commands needed are there, ready for copy/paste. On script 2 we need to generate our pattern to locate the EIP. The instructions tell us to locate and use pattern_create.rb and then use mona to find the offset.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/bof/pic5.png" alt="Offset" /></p><p>Input the variables, then locate and use the pattern_create command to generate the pattern. If you have not moved the pattern create file it is here:</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>/usr/share/metasploit-framework/tools/exploit/pattern_create.rb <span class="nt">-l</span> 3000
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/bof/pic11.png" alt="Pattern" /></p><p>Copy the pattern and paste in between the quotes where instructed.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/bof/pic12.png" alt="Pattern" /></p><p>Right click on the Vulnserver exe and run it as administrator. All you will see is this, so you can just minimize the window.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/bof/pic7.png" alt="VS1" /></p><p>Then do the same with Immunity Debugger. Immunity may open up with it’s internal windows in weird places; if it does, click window in the top menu, make sure CPU is ticked, then maximize the CPU window inside of Immunity.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/bof/pic8.png" alt="DBG" /></p><p>Because you’re running these programs as administrator, you will likely be asked to allow that. When Immunity opens up, in the upper left, click file, click attach, click vulnserver and click attach.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/bof/pic9.png" alt="Attach" /></p><p>It will attach the program in a paused state (yellow box in lower right). Click the red “play” button in the top tool bar to let the program resume.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/bof/pic10.png" alt="Attached" /></p><p>A quick bit of trouble shooting shows me that I need to put my terminal into Python 2.7 and then the script then runs and crashes the program. You can see the yellow “Paused” has returned to the lower right and there is parts of our pattern string in the Registers window.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/bof/pic13.png" alt="Crash1" /></p><p>You can see the characters in the EIP when it crashed were <code class="language-plaintext highlighter-rouge">6F43376F</code>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/bof/pic14.png" alt="EIP" /></p><p>The instructions say to use the following command to find the offset, so I will enter that into the input bar at the bottom of the debugger.</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="o">!</span>mona findmsp
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/bof/pic15.png" alt="Mona" /></p><p>It’s not easy to see, but if you look close, you can see the line that says the EIP has our pattern and the offset is 2002.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/bof/pic16.png" alt="Offset" /></p><p>We now know that our offset is 2002 bytes. We will confirm that by copying our variables and opening up script 3.</p><h2 id="overwrite-the-eip">Overwrite The EIP</h2><p>Paste in the variables from script 2 and add in the offset (2002).</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/bof/pic17.png" alt="Overwrite" /> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/bof/pic18.png" alt="Overwrite" /></p><p>That is all we have to do for this step! Unfortunately, we must restart Vulnserver and Immunity at each step, so close them down and run them as administrator, then attach the program to the debugger just as before. Make sure it says “Running” in the lower right and execute the script.</p><p>The program crashes as designed and we can see in the Registers panel (upper right) that the EIP has been overwritten with “42424242”, which means we control the EIP!</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/bof/pic19.png" alt="4242" /></p><p>Copy the variables, open script 4 and paste them in.</p><h2 id="find-bad-characters">Find Bad Characters</h2><p>Once the variables are pasted in, nothing more needs to be done for the first run of script 4. Restart Vulnserver and Immunity and run the script.</p><p>What this script does is find the bad characters that we cannot use in our shell code. If you look in the folder the script is running from, you should now see a file called <code class="language-plaintext highlighter-rouge">badchar_test.bin</code>. This needs to go over to the machine that Immunity is running on. The certutil.exe command is in the instructions if you are going to transfer the file that way.</p><p>I will move this file to my Sync folder and it will end up on my host machine. Line b in the instructions box has the mona command that needs to be run, so just make sure the badchar file is actually where you’re saying it is (C:\ in my case) and paste the command into the Immunity command line.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/bof/pic21.png" alt="badchar" /></p><p>For this machine, there are no bad characters, other than the null byte, which is always bad. The mona Memory comparison results window shows “Unmodified” in the status column - this is how we know that we have included all bad characters in the script. This is highly unlikely to be the case on other buffer overflow exploits, especially in any exam you may be studying for. It would be far more likely to get a long list of bad characters such as this.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/bof/pic22.png" alt="badchar2" /></p><p>If you look at line 28 of script 4, you will see where all of the known badchars are. We need to add in all bad chars found in the first run of the test (none in our case). Note the format at the end of the comment.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/bof/pic23.png" alt="badchar3" /></p><p>Once the found badchars are entered, reset Immunity and Vulnserver and run the script again and transfer the new badchar_test.bin file to Immunity and run mona compare again. Hopefully it will come back as Unmodified, if not, continue the process until it does.</p><p>We know that Vulnserver has no extra bad characters, so we copy our variables and move to script 5.</p><h2 id="find-the-jump-point">Find The Jump Point</h2><p>Script 5 tells us we need to find a new variable.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/bof/pic24.png" alt="Jump" /></p><p>Follow the instructions in the script and <strong><em>don’t forget to add in the bad characters</em></strong>!! Note that the format is slightly different than the format used in script 4 to find the bad chars (\x00 vs. 0x00). Copy the mona command and paste it into the Immunity command line. This can be done whether the program is crashed or running.</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="o">!</span>mona jmp <span class="nt">-r</span> esp <span class="nt">-cpb</span> <span class="s2">"</span><span class="se">\x</span><span class="s2">00"</span>
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/bof/pic25.png" alt="ESP" /></p><p>We need the info from the <em>Log data</em> page, so if it does not pop up automatically, select it from the Window menu at the top. If your eyes are like mine, you’ll struggle to read that, but we have a list of suitable jump points. We will work our way down the list, which starts with <code class="language-plaintext highlighter-rouge">625011af</code></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/bof/pic26.png" alt="625011af" /></p><p>Enter this into the missing variable field at the top, leaving the prefix <strong><em>0x</em></strong>. <strong>DO NOT CONVERT THIS TO LITTLE ENDIAN</strong> - the script does that for you. Have a look at the instructions for more info.</p><p>If Vulnserver is still crashed, restart.</p><p>The script runs, the application crashes and what we want to see is our C’s sitting in the upper left, which we do!</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/bof/pic27.png" alt="CC" /></p><p>We now know that we have command execution. You could go straight for a reverse shell, but I strongly suggest you test your execution by using the tried and trued “Pop Calc.” My reason for this is you only want to trouble shoot one thing at a time. If you can get the calculator to pop, you know your command execution is sorted, so if you’re not getting a reverse shell at the next step, you know it’s the shell and not your command execution. Skip this next step at your own peril!</p><h2 id="pop-calc">Pop Calc</h2><p>As always, copy the variables and paste them into script 6. The instructions have the command to generate the “popcalc” shell. Generate, copy and paste where instructed.</p><p><strong><em>DO NOT FORGET THE BAD CHARACTERS</em></strong></p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>msfvenom <span class="nt">-p</span> windows/exec <span class="nt">-b</span> <span class="s1">'\x00'</span> <span class="nt">-f</span> python <span class="nt">--var-name</span> popcalc <span class="nv">CMD</span><span class="o">=</span>calc.exe <span class="nv">EXITFUNC</span><span class="o">=</span>thread
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/bof/pic28.png" alt="popcalc" /> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/bof/pic29.png" alt="popcalc" /></p><p>Restart the app. You don’t actually need Immunity from here on out, but if you’re like me, you’ll restart it out of habit. Run your script and with any luck, you should see a calulator appear as if by magic! If you don’t see it, check the task bar or the task manager to see if it’s hidden under another window or running in the background.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/bof/pic30.png" alt="calc" /></p><p>Huzzah!! We have our magical calculator and know that our command execution is dialed in so we can concentrate on sorting out our reverse shell.</p><h2 id="reverse-shell">Reverse Shell</h2><p>Open up the Money Shot script and paste in your variables. I’ve included some fairly standard msfvenom shells, which may or may not work right out of the box. The first error you are likely to encounter is it not liking the shikata_ga_nai encoder. If that should be the case, simply remove the <code class="language-plaintext highlighter-rouge">-e x86/shikata_ga_nai</code> from the msfvenom command.</p><p>If you’re reading this in preperation for an exam, I wish you all the best.</p><p>Link to the video: <a href="https://youtu.be/kw4XbeoS8z8">https://youtu.be/kw4XbeoS8z8</a></p><p>Happy hacking!</p><p>M0nkey</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/notes/'>Notes</a>, <a href='/categories/buffer_overflow/'>Buffer_Overflow</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/bof/" class="post-tag no-text-decoration" >BOF</a> <a href="/tags/mona/" class="post-tag no-text-decoration" >Mona</a> <a href="/tags/immunity/" class="post-tag no-text-decoration" >Immunity</a> <a href="/tags/vulnserver/" class="post-tag no-text-decoration" >Vulnserver</a> <a href="/tags/oscp/" class="post-tag no-text-decoration" >OSCP</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><!-- Post sharing snippet v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Buffer Overflow Demo - Flying_M0nkey&url=protocol://FlyingM0nkey.github.io/posts/BOF/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Buffer Overflow Demo - Flying_M0nkey&u=protocol://FlyingM0nkey.github.io/posts/BOF/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Buffer Overflow Demo - Flying_M0nkey&url=protocol://FlyingM0nkey.github.io/posts/BOF/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><!-- The Pannel on right side (Desktop views) v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><h3 data-toc-skip>Recent Update</h3><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Passwords/">Password Cracking</a></li><li><a href="/posts/Blackfield/">Blackfield [HTB]</a></li><li><a href="/posts/Devel/">Devel [HTB]</a></li><li><a href="/posts/Legacy/">Legacy [HTB]</a></li><li><a href="/posts/BOF/">Buffer Overflow Demo</a></li></ul></div><div id="access-tags"><h3 data-toc-skip>Trending Tags</h3><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/walkthrough/">Walkthrough</a> <a class="post-tag" href="/tags/jtr/">JTR</a> <a class="post-tag" href="/tags/hashcat/">Hashcat</a> <a class="post-tag" href="/tags/htb/">HTB</a> <a class="post-tag" href="/tags/zip2john/">zip2john</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/smb/">SMB</a> <a class="post-tag" href="/tags/passwords/">Passwords</a> <a class="post-tag" href="/tags/metasploit/">Metasploit</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><h3 data-toc-skip class="pl-3 pt-2 mb-2">Contents</h3><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <!-- Recommend the other 3 posts according to the tags and categories of the current post, if the number is not enough, use the other latest posts to supplement. v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Passwords/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Sep 22 <i class="unloaded">2020-09-22T18:08:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Password Cracking</h3><div class="text-muted small"><p> Password cracking, brute forcing and wordlist creation are an important part of infosec, from doing CTF’s as a hobby or as a professional pentester, having a solid methodology to giving yourself th...</p></div></div></a></div><div class="card"> <a href="/posts/PMKID/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Oct 7 <i class="unloaded">2020-10-07T18:08:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>WiFi PMKID Capture</h3><div class="text-muted small"><p> Even in 2020 it is still easy to steal WiFi credentials. The video at the bottom is almost entirely in real time. With a 10,000 word long wordlist, it took far longer to write these notes than it d...</p></div></div></a></div><div class="card"> <a href="/posts/FFuF/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Nov 24 <i class="unloaded">2020-11-24T18:08:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>FFuF</h3><div class="text-muted small"><p> Just my notes on how to use FFuF. Most of these examples can be seen on the HTB Academy FFuF module. Fuzzing for Subdirectories 1 ffuf -c -w /usr/share/seclists/Discovery/Web-Content/directory-lis...</p></div></div></a></div></div></div><!-- Navigation buttons at the bottom of the post. v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --><div class="post-navigation d-flex justify-content-between"> <a href="/posts/PMKID/" class="btn btn-outline-primary"><p>WiFi PMKID Capture</p></a> <a href="/posts/Legacy/" class="btn btn-outline-primary"><p>Legacy [HTB]</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script> <!-- The Footer v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2020 <a href="https://github.com/FlyingM0nkey">King_Kong</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/">Chirpy</a> theme.</p></div></div></footer></div><!-- The Search results v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/walkthrough/">Walkthrough</a> <a class="post-tag" href="/tags/jtr/">JTR</a> <a class="post-tag" href="/tags/hashcat/">Hashcat</a> <a class="post-tag" href="/tags/htb/">HTB</a> <a class="post-tag" href="/tags/zip2john/">zip2john</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/smb/">SMB</a> <a class="post-tag" href="/tags/passwords/">Passwords</a> <a class="post-tag" href="/tags/metasploit/">Metasploit</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <!-- The GA snippet v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', '', 'auto'); ga('send', 'pageview'); </script> <!-- Jekyll Simple Search loader v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="protocol://FlyingM0nkey.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
